(function(e,g){function l(a){var b=this;this.$element=a.$element;if(a.options.socket===g)throw"A socket must be passed as an argument to use liveSortable.";this.socket=a.options.socket;e.each(a.customEvents,function(a,d){b.addEvent(d)});return this}function h(a,b){this.$element=a;this.options=e.extend({},k,b);this.events=e.extend({},k.events,this.options.events);this.sortableOptions=e.extend({},k.sortable,this.options.sortable);this.$element.sortable(this.sortableOptions);this.customEvents=f.create(this);
this._socketEventer=new l(this);this.getSocket=function(){return this._socketEventer.socket};this.options.cancelSedingInRealtime||this.addMousemoveHandler();return this}if(e===g)throw"jQuery should be defined to use liveSortable";if(!1 in e.fn)throw"jQuery UIs sortable should be defined to use liveSortable";var k={cancelRealtime:!1,cancelSedingInRealtime:!1,delay:0,events:{start:function(){},beforeStop:function(){},stop:function(){},mousemove:function(){}},sortable:{helper:"clone",start:function(a,
b){var c=h.getInstanceFrom(this),d=c.getSocket(),e=c.events.start(a,b,c)||{id:b.item.get(0).id};d.emit(f.addSufix("broadcast_move_started"),e);c.isBeingDragged=!0},beforeStop:function(a,b){var c=h.getInstanceFrom(this),d=c.getSocket(),c=c.events.beforeStop(a,b,c);if(!c)var c=b.item,e=c.next().get(0),g=c.prev().get(0),c={id:c.get(0).id,next:e&&e.id,prev:g&&g.id};d.emit(f.addSufix("broadcast_move_ended"),c)},stop:function(a,b){var c=h.getInstanceFrom(this);c.events.stop(a,b,c);c.isBeingDragged=!1}}},
f={sufix:".liveSortable",addSufix:function(a){return a+f.sufix},create:function(a){var b=["move_element","move_started","move_ended"];a.options.cancelRealtime&&(b=b.slice(1));return e.map(b,this.addSufix)}};l.prototype={eventHandlers:{},addEvent:function(a){var b=this,c=function(c){b.$element.trigger(a,c)};this.eventHandlers[a]=c;this.socket.on(a,c)},removeEvent:function(a){this.socket.removeListener(a,this.eventHandlers[a])},removeAllEvents:function(){this.socket.removeAllListeners()}};h.prototype=
{isBeingDragged:!1,addMousemoveHandler:function(){var a=this;return this.$element.on(f.addSufix("mousemove"),function(b){a.isBeingDragged&&(b=a.events.mousemove(b,a),b||(b=a.$element.children(".ui-sortable-helper").get(0),b={id:b.id,top:b.style.top,left:b.style.left}),a._socketEventer.socket.emit(f.addSufix("broadcast_moving_element"),b),0<a.options.delay&&(a.removeMousemoveHandler(),setTimeout(function(){a.addMousemoveHandler()},a.options.delay)))})},removeMousemoveHandler:function(){return this.$element.off(f.addSufix("mousemove"))},
remove:function(){this.$element.removeData("plugin_liveSortable").off(f.sufix);this._socketEventer.removeAllEvents();return this.$element},toggleOption:function(a){this.options[a]=!this.options[a];return this.options[a]},toggleRealtime:function(){var a=f.addSufix("move_element");this.toggleOption("cancelRealtime")?this._socketEventer.removeEvent(a):this._socketEventer.addEvent(a)},toggleRealtimeSending:function(){this.toggleOption("cancelSedingInRealtime")?this.removeMousemoveHandler():this.addMousemoveHandler()},
delay:function(a){this.options.delay=a}};h.getInstanceFrom=function(a){return e(a).data("plugin_liveSortable")};e.fn.liveSortable=function(a){var b="string"===typeof a;if(b)var c=Array.prototype.slice.call(arguments,1);return this.each(function(){var d=e(this);if(b){d=d.data("plugin_liveSortable");if(!d)throw"Method called on liveSortable before instantiation";if(!e.isFunction(d[a]))throw"The method: "+a+" was not found in liveSortable";d=d[a].apply(d,c);if(d!==g)return d}else d.data("plugin_liveSortable",
new h(d,a))})}})(jQuery);